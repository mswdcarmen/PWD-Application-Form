<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PWD Application - Municipality of Carmen, Cebu</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f5ff;
    color: #003366;
    margin: 0; padding: 20px;
  }
  header {
    display: flex; align-items: center; gap: 15px;
    margin-bottom: 20px;
  }
  header img {
    height: 60px;
  }
  header h1 {
    font-size: 1.8rem;
    color: #004080;
  }
  form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,50,0.1);
    max-width: 900px;
    margin: auto;
  }
  fieldset {
    border: 2px solid #0073e6;
    border-radius: 8px;
    padding: 15px 20px 20px;
    margin-bottom: 20px;
  }
  legend {
    font-weight: bold;
    font-size: 1.1rem;
    color: #004080;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: 600;
  }
  input[type="text"],
  input[type="date"],
  input[type="email"],
  input[type="tel"],
  select,
  textarea {
    width: 100%;
    padding: 7px 10px;
    margin-top: 5px;
    border: 2px solid #0073e6;
    border-radius: 5px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:hover,
  input[type="date"]:hover,
  input[type="email"]:hover,
  input[type="tel"]:hover,
  select:hover,
  textarea:hover {
    border-color: #0059b3;
  }
  input[type="text"]:focus,
  input[type="date"]:focus,
  input[type="email"]:focus,
  input[type="tel"]:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: #003366;
    box-shadow: 0 0 5px #003366;
  }
  .small-input {
    width: 150px;
  }
  .row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .row > div {
    flex: 1 1 300px;
  }
  .photo-preview {
    margin-top: 10px;
    max-width: 100px;
    max-height: 100px;
    border-radius: 8px;
    border: 1px solid #0073e6;
    display: none;
  }
  button {
    background-color: #0073e6;
    color: white;
    font-weight: 700;
    border: none;
    padding: 12px 30px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 15px;
  }
  button:hover {
    background-color: #0059b3;
  }

  /* Confirmation Modal */
  #confirmationModal {
    position: fixed;
    top: 0; left: 0; right:0; bottom: 0;
    background-color: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #confirmationModal .modal-content {
    background: white;
    padding: 20px;
    max-width: 500px;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    white-space: pre-wrap;
    color: #003366;
    max-height: 80vh;
    overflow-y: auto;
  }
  #confirmationModal button {
    margin: 10px 10px 0 0;
  }
</style>
</head>
<body>

<header>
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Ph_seal_Cebu.svg/120px-Ph_seal_Cebu.svg.png" alt="Municipality of Carmen Cebu Logo" />
  <h1>PWD Application Form<br>Municipality of Carmen, Cebu</h1>
</header>

<form id="pwdForm">
  <fieldset>
    <legend>1. Applicant Type</legend>
    <select name="applicant_type" required>
      <option value="">Select...</option>
      <option value="New Applicant">New Applicant</option>
      <option value="Renewal">Renewal</option>
      <option value="Transfer to Other Barangay">Transfer to Other Barangay</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>2. Person with Disability Number </legend>
    <input type="number" name="age" required min="0" max="120">
    <input type="number" name="age" min="0" max="120">
  </fieldset>

  <fieldset>
    <legend>3. Date Applied</legend>
    <input type="date" id="date_applied" name="date_applied" required readonly />
  </fieldset>

  <fieldset>
    <legend>4. Insert 1x1 Photo (max 10MB)</legend>
    <input type="file" id="photo" name="photo" accept="image/*" />
    <img id="photo_preview" class="photo-preview" alt="Photo Preview" />
  </fieldset>

  <fieldset>
    <legend>5. Personal Information</legend>
    <div class="row">
      <div><label>Last Name</label><input type="text" name="last_name" required /></div>
      <div><label>First Name</label><input type="text" name="first_name" required /></div>
      <div><label>Middle Name</label><input type="text" name="middle_name" /></div>
      <div><label>Suffix</label><input type="text" name="suffix" /></div>
    </div>
  </fieldset>

  <fieldset>
    <legend>6. Date of Birth, Blood Type, Sex</legend>
    <div class="row">
      <div><label>Date of Birth</label><input type="date" name="birth_date" required /></div>
      <div><label>Blood Type</label>
        <select name="blood_type" required>
          <option value="">Select...</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
      </div>
      <div><label>Sex</label>
        <select name="sex" required>
          <option value="">Select...</option>
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>
    </div>
  </fieldset>

  <fieldset>
    <legend>7. Civil Status</legend>
    <select name="civil_status" required>
      <option value="">Select...</option>
      <option>Single</option>
      <option>Married</option>
      <option>Widowed</option>
      <option>Separated</option>
      <option>Divorced</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>8. Type of Disability</legend>
    <select name="type_of_disability" required>
      <option value="">Select...</option>
      <option>Deaf/Hard Hearing</option>
      <option>Intellectual disability</option>
      <option>Learning disability</option>
      <option>Mental disability</option>
      <option>Physical disability (Orthopedic)</option>
      <option>Psychosocial Disability</option>
      <option>Speech and Language Impairment</option>
      <option>Visual Disability</option>
      <option>Cancer (RA11215)</option>
      <option>Rare Disease (RA10747)</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>9. Cause of Disability</legend>
    <div>
      <label><strong>Congenital/inborn</strong></label>
      <select name="cause_congenital" >
        <option value="">Select...</option>
        <option>ADHD</option>
        <option>Cerebral Palsy</option>
        <option>Down Syndrome</option>
        <option>Others</option>
      </select>
      <input type="text" name="cause_congenital_others" placeholder="If Others, specify" />
    </div>
    <div style="margin-top: 10px;">
      <label><strong>Acquired</strong></label>
      <select name="cause_acquired" >
        <option value="">Select...</option>
        <option>Chronic Illness</option>
        <option>Cerebral Palsy</option>
        <option>Injury</option>
        <option>Others</option>
      </select>
      <input type="text" name="cause_acquired_others" placeholder="If Others, specify" />
    </div>
  </fieldset>

  <fieldset>
    <legend>10. Residence Address</legend>
    <input type="text" name="house_no_street" placeholder="House No. and Street" required />
    <input type="text" name="barangay" placeholder="Barangay" required />
    <input type="text" name="municipality" value="Carmen" readonly />
    <input type="text" name="province" value="Cebu" readonly />
    <input type="text" name="region" value="VII" readonly />
  </fieldset>

  <fieldset>
    <legend>11. Contact Details</legend>
    <input type="tel" name="landline_no" placeholder="Landline No. (optional)" />
    <input type="tel" name="mobile_no" placeholder="Mobile No." required />
    <input type="email" name="email" placeholder="Email Address (optional)" />
  </fieldset>

  <fieldset>
    <legend>12. Educational Attainment</legend>
    <select name="educational_attainment" required>
      <option value="">Select...</option>
      <option>None</option>
      <option>Kindergarten</option>
      <option>Elementary</option>
      <option>Junior High School</option>
      <option>Senior High School</option>
      <option>College</option>
      <option>Vocational</option>
      <option>Post graduate program</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>13. Status of Employment</legend>
    <select id="status_employment" name="status_of_employment" required>
      <option value="">Select...</option>
      <option>Employed</option>
      <option>Unemployed</option>
      <option>Self-employed</option>
    </select>
    <div id="employmentDetails" style="margin-top:10px; display:none;">
      <label>Category of Employment</label>
      <select id="category_employment" name="category_of_employment">
        <option value="">Select...</option>
        <option>Government</option>
        <option>Private</option>
      </select>

      <label>Type of Employment</label>
      <select id="type_employment" name="type_of_employment">
        <option value="">Select...</option>
        <option>Permanent/Regular</option>
        <option>Seasonal</option>
        <option>Casual</option>
        <option>Emergency</option>
      </select>
    </div>
  </fieldset>

  <fieldset>
    <legend>Occupation</legend>
    <select id="occupation" name="occupation" required>
      <option value="">Select...</option>
      <option>Managers</option>
      <option>Professionals, technical and associate professionals</option>
      <option>Clerical Support Workers</option>
      <option>Service and Sales Workers</option>
      <option>Skilled Agricultural Forestry and Fishery worker</option>
      <option>Craft and Related trade Workers</option>
      <option>Plant and Machine Operators and Assemblers</option>
      <option>Elementary Occupations</option>
      <option>Armed Forces Occupation</option>
      <option>Others</option>
    </select>
    <input type="text" id="occupation_others" name="occupation_others" placeholder="If Others, specify" style="display:none; margin-top: 5px;" />
  </fieldset>

  <fieldset>
    <legend>15. Organization Information</legend>
    <input type="text" name="organization_affiliated" placeholder="Organization Affiliated" />
    <input type="text" name="contact_person" placeholder="Contact Person" />
    <input type="text" name="office_address" placeholder="Office Address" />
    <input type="tel" name="office_tel" placeholder="Tel. No. (optional)" />
  </fieldset>

  <fieldset>
    <legend>16. ID Reference No.</legend>
    <input type="text" name="sss_no" placeholder="SSS No." />
    <input type="text" name="gsis_no" placeholder="GSIS No." />
    <input type="text" name="pagibig_no" placeholder="Pag-ibig No." />
    <input type="text" name="philhealth_no" placeholder="Phil Health No." />
  </fieldset>

  <fieldset>
    <legend>17. Family Background</legend>
    <label>Father's Name</label>
    <input type="text" name="father_last_name" placeholder="Last Name" />
    <input type="text" name="father_first_name" placeholder="First Name" />
    <input type="text" name="father_middle_name" placeholder="Middle Name" />

    <label>Mother's Name</label>
    <input type="text" name="mother_last_name" placeholder="Last Name" />
    <input type="text" name="mother_first_name" placeholder="First Name" />
    <input type="text" name="mother_middle_name" placeholder="Middle Name" />

    <label>Guardian's Name</label>
    <input type="text" name="guardian_last_name" placeholder="Last Name" />
    <input type="text" name="guardian_first_name" placeholder="First Name" />
    <input type="text" name="guardian_middle_name" placeholder="Middle Name" />

    <label>Parents/Guardian Contact No.</label>
    <input type="tel" name="parents_guardian_contact" placeholder="Contact Number" />
  </fieldset>

  <fieldset>
    <legend>18. Spouse Information (if married)</legend>
    <input type="text" name="spouse_last_name" placeholder="Last Name" />
    <input type="text" name="spouse_first_name" placeholder="First Name" />
    <input type="text" name="spouse_middle_name" placeholder="Middle Name" />
    <input type="text" name="spouse_occupation" placeholder="Occupation" />
  </fieldset>

  <fieldset>
    <legend>19. Others</legend>
    <label>Source of Income</label>
    <input type="text" name="source_of_income" />
    <label>Monthly Income</label>
    <input type="text" name="monthly_income" />
    <label>Educational Assistance / Other Assistance Availed</label>
    <input type="text" name="educational_assistance" />
    <label>Livelihood Assistance Availed</label>
    <input type="text" name="livelihood_assistance" />
    <label>Other Assistance Availed</label>
    <input type="text" name="other_assistance" />
  </fieldset>

  <fieldset>
    <legend>20. Additional Remarks</legend>
    <textarea name="remarks" rows="4" placeholder="Write additional remarks here..."></textarea>
  </fieldset>

  <button type="submit">Submit Application</button>
</form>

<!-- Confirmation Modal -->
<div id="confirmationModal">
  <div class="modal-content">
    <h2>Please Confirm Your Data</h2>
    <pre id="confirmationText"></pre>
    <button id="editBtn">Edit</button>
    <button id="confirmBtn">Confirm</button>
  </div>
</div>

<script>
  // Auto set date applied to today (YYYY-MM-DD)
  const dateAppliedInput = document.getElementById('date_applied');
  dateAppliedInput.value = new Date().toISOString().slice(0,10);

  // Photo preview
  const photoInput = document.getElementById('photo');
  const photoPreview = document.getElementById('photo_preview');
  photoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file) {
      const url = URL.createObjectURL(file);
      photoPreview.src = url;
      photoPreview.style.display = 'inline-block';
    } else {
      photoPreview.style.display = 'none';
    }
  });

  // Show/hide employment details
  const statusEmployment = document.getElementById('status_employment');
  const employmentDetails = document.getElementById('employmentDetails');
  statusEmployment.addEventListener('change', () => {
    if (statusEmployment.value === 'Employed') {
      employmentDetails.style.display = 'block';
    } else {
      employmentDetails.style.display = 'none';
      document.getElementById('category_employment').value = '';
      document.getElementById('type_employment').value = '';
    }
  });

  // Show/hide occupation others input
  const occupationSelect = document.getElementById('occupation');
  const occupationOthersInput = document.getElementById('occupation_others');
  occupationSelect.addEventListener('change', () => {
    if(occupationSelect.value === 'Others') {
      occupationOthersInput.style.display = 'block';
      occupationOthersInput.required = true;
    } else {
      occupationOthersInput.style.display = 'none';
      occupationOthersInput.required = false;
      occupationOthersInput.value = '';
    }
  });

  // Modal elements
  const modal = document.getElementById('confirmationModal');
  const confirmationText = document.getElementById('confirmationText');
  const editBtn = document.getElementById('editBtn');
  const confirmBtn = document.getElementById('confirmBtn');
  const form = document.getElementById('pwdForm');

  // Utility: Convert file to Base64
  function getBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }

  // Prepare summary text for confirmation modal
  function prepareConfirmationText(formData) {
    const entries = [];
    for (const [key, value] of formData.entries()) {
      if(key === 'photoBase64') continue; // skip large base64 photo
      if(value.trim() !== '') {
        entries.push(`${key.replace(/_/g, ' ')}: ${value}`);
      }
    }
    return entries.join('\n');
  }

  // Show confirmation modal with data preview
  form.addEventListener('submit', async e => {
    e.preventDefault();

    // Validate form before confirmation
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    // Prepare form data
    const formData = new FormData(form);

    // Convert photo to base64 string
    const photoFile = photoInput.files[0];
    if(photoFile) {
      if(photoFile.size > 10*1024*1024) {
        alert('Photo must be less than 10MB.');
        return;
      }
      try {
        const base64 = await getBase64(photoFile);
        formData.append('photoBase64', base64);
      } catch(err) {
        alert('Error reading photo file.');
        return;
      }
    } else {
      formData.append('photoBase64', '');
    }

    // Show confirmation modal with summary
    confirmationText.textContent = prepareConfirmationText(formData);
    modal.style.display = 'flex';

    // Temporarily save formData in modal's dataset for submit on confirm
    modal.dataset.formData = JSON.stringify(Object.fromEntries(formData.entries()));
  });

  // Edit button closes modal
  editBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  // Confirm button sends data to Google Apps Script
  confirmBtn.addEventListener('click', async () => {
    const dataObj = JSON.parse(modal.dataset.formData);
    modal.style.display = 'none';

    // Send POST request
    try {
      const resp = await fetch('https://script.google.com/macros/s/AKfycbzW7ND_-TOzYH3TlDtfssyZiK_1xnIGRWlF5jf4dVXdxNIIKCiBj_4WbfnEBDJAgKId/exec', {
        method: 'POST',
        body: new URLSearchParams(dataObj),
      });
      const result = await resp.json();

      if(result.result === 'success') {
        alert('Form submitted successfully!');
        form.reset();
        photoPreview.style.display = 'none';
        // Reset date applied to today again
        dateAppliedInput.value = new Date().toISOString().slice(0,10);
        // Hide optional fields if needed
        employmentDetails.style.display = 'none';
        occupationOthersInput.style.display = 'none';
      } else {
        alert('Submission failed: ' + result.message);
      }
    } catch(err) {
      alert('Error submitting form: ' + err.message);
    }
  });
</script>

</body>
</html>
